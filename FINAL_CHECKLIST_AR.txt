═══════════════════════════════════════════════════════════
✅ Checklist النهائي - جاهز للنشر
═══════════════════════════════════════════════════════════

📅 التاريخ: 29 أكتوبر 2025
🌐 الدومين: https://nnh.ae
📦 المشروع: GMB Platform

═══════════════════════════════════════════════════════════
🔑 الجزء الأول: التحقق من المفاتيح
═══════════════════════════════════════════════════════════

✅ جميع المفاتيح موجودة في Replit Secrets:

Google OAuth:
  ✓ GOOGLE_CLIENT_ID
  ✓ GOOGLE_CLIENT_SECRET
  ✓ GOOGLE_REDIRECT_URI

Supabase:
  ✓ NEXT_PUBLIC_SUPABASE_URL
  ✓ NEXT_PUBLIC_SUPABASE_ANON_KEY
  ✓ SUPABASE_SERVICE_ROLE_KEY

Domain:
  ✓ NEXT_PUBLIC_BASE_URL

═══════════════════════════════════════════════════════════
🗄️ الجزء الثاني: إعداد Supabase
═══════════════════════════════════════════════════════════

□ الخطوة 1: تطبيق Database Schema
  
  في Supabase Dashboard:
  1. افتح: https://supabase.com/dashboard
  2. اختر المشروع: GMB Platform
  3. اذهب لـ: SQL Editor
  4. اضغط "New Query"
  5. انسخ محتوى كل ملف من هذه الملفات واحد تلو الآخر:
     
     أ. supabase/migrations/20251029_create_oauth_tables.sql
     ب. supabase/migrations/20251029_add_user_id_columns.sql
     ج. supabase/migrations/20251029_enable_rls_gmb_accounts.sql
     د. supabase/migrations/20251029_enable_rls_policies.sql
  
  6. شغّل كل query بالضغط على "Run"
  7. تأكد من ظهور "Success" لكل query

  ✓ للتحقق:
    → اذهب لـ Table Editor
    → يجب أن تشوف الجداول:
      • profiles
      • gmb_accounts
      • gmb_locations
      • gmb_reviews
      • oauth_states
      • activity_logs

────────────────────────────────────────────────────────────

□ الخطوة 2: إعداد Site URL

  في Supabase Dashboard:
  1. اذهب لـ: Authentication → URL Configuration
  2. املأ:
     Site URL: https://nnh.ae
     Redirect URLs: https://nnh.ae/**
  3. اضغط "Save"

────────────────────────────────────────────────────────────

□ الخطوة 3: إعداد Google OAuth Provider

  في Supabase Dashboard:
  1. اذهب لـ: Authentication → Providers
  2. ابحث عن "Google" واضغط عليه
  3. فعّل: ☑ Enable Sign in with Google
  4. املأ:
     Client ID: (من Google Console - موجود في Replit Secrets)
     Client Secret: (من Google Console - موجود في Replit Secrets)
  5. اضغط "Save"

═══════════════════════════════════════════════════════════
🔧 الجزء الثالث: التأكد من Google Console
═══════════════════════════════════════════════════════════

في Google Cloud Console:

□ الخطوة 1: التأكد من Redirect URI
  
  1. افتح: https://console.cloud.google.com
  2. اذهب لـ: APIs & Services → Credentials
  3. اضغط على OAuth 2.0 Client ID الخاص بك
  4. في "Authorized redirect URIs"، تأكد من وجود:
     
     ✓ https://nnh.ae/api/gmb/oauth-callback
  
  5. إذا مو موجود، أضفه واضغط "Save"
  6. انتظر 5-10 دقائق بعد التغيير

────────────────────────────────────────────────────────────

□ الخطوة 2: التأكد من تفعيل APIs

  في Google Cloud Console:
  APIs & Services → Enabled APIs & services
  
  تأكد من تفعيل:
  ✓ Google Business Profile API
  ✓ My Business Business Information API
  ✓ My Business Account Management API
  ✓ My Business Verifications API

────────────────────────────────────────────────────────────

□ الخطوة 3: التأكد من OAuth Consent Screen

  في Google Cloud Console:
  APIs & Services → OAuth consent screen
  
  تأكد من:
  ✓ Publishing status: In production أو Testing
  ✓ Scopes: business.manage, userinfo.email, userinfo.profile
  ✓ Test users: إذا في وضع Testing، أضف بريدك

═══════════════════════════════════════════════════════════
🧪 الجزء الرابع: الاختبار
═══════════════════════════════════════════════════════════

□ اختبار 1: الموقع يعمل

  1. افتح: https://nnh.ae (أو الـ Replit URL مؤقتاً)
  2. الصفحة الرئيسية تظهر بشكل صحيح
  3. لا توجد أخطاء في Console (F12)

────────────────────────────────────────────────────────────

□ اختبار 2: Supabase Authentication

  1. افتح الموقع
  2. اذهب لـ: Sign Up
  3. أنشئ حساب جديد بالـ Email
  4. يجب أن يرسل Email verification
  5. تأكد من إمكانية تسجيل الدخول

────────────────────────────────────────────────────────────

□ اختبار 3: Google OAuth Flow

  1. سجل دخول للموقع
  2. اذهب لصفحة: Accounts (/accounts)
  3. اضغط "Connect Google Account"
  4. يجب أن:
     • تفتح صفحة Google للموافقة
     • تطلب منك الموافقة على Scopes
     • بعد الموافقة، ترجع للموقع
     • يظهر حسابك في قائمة Accounts
  
  ⚠️ إذا ظهر خطأ "redirect_uri_mismatch":
     → راجع الخطوة 1 في الجزء الثالث
     → تأكد من URI مطابق بالضبط

────────────────────────────────────────────────────────────

□ اختبار 4: GMB Data Sync

  بعد ربط حساب Google:
  1. اذهب لصفحة: Locations (/locations)
  2. يجب أن تظهر المواقع من GMB
  3. اذهب لصفحة: Reviews (/reviews)
  4. يجب أن تظهر التقييمات

═══════════════════════════════════════════════════════════
🚀 الجزء الخامس: النشر على nnh.ae
═══════════════════════════════════════════════════════════

□ الخطوة 1: Deploy على Replit

  1. في Replit، اضغط زر "Deploy"
  2. اختر: Autoscale deployment
  3. انتظر حتى يكتمل الـ build
  4. تأكد من ظهور "Deployment successful"

────────────────────────────────────────────────────────────

□ الخطوة 2: ربط Custom Domain

  1. في Deployment settings، اضغط "Add custom domain"
  2. أدخل: nnh.ae
  3. اتبع التعليمات لإضافة DNS records:
     - CNAME record: من nnh.ae إلى [replit-url]
  4. انتظر حتى يتحقق من الـ domain
  5. سيتم إصدار SSL certificate تلقائياً

────────────────────────────────────────────────────────────

□ الخطوة 3: تحديث URLs في Google Console

  بعد نشر الموقع على nnh.ae:
  
  في Google Cloud Console:
  1. اذهب لـ: APIs & Services → Credentials
  2. OAuth 2.0 Client ID
  3. تأكد أن Redirect URI هو:
     https://nnh.ae/api/gmb/oauth-callback
  
  (إذا كان موجود، لا تحتاج تغيير شي)

────────────────────────────────────────────────────────────

□ الخطوة 4: تحديث URLs في Supabase

  في Supabase Dashboard:
  1. Authentication → URL Configuration
  2. تأكد من:
     Site URL: https://nnh.ae
     Redirect URLs: https://nnh.ae/**

────────────────────────────────────────────────────────────

□ الخطوة 5: الاختبار النهائي

  1. افتح: https://nnh.ae
  2. سجل دخول
  3. اربط حساب Google
  4. تأكد من ظهور Locations و Reviews
  5. جرب جميع الميزات:
     • Dashboard
     • Accounts
     • Locations
     • Reviews
     • Settings

═══════════════════════════════════════════════════════════
✅ Checklist السريع
═══════════════════════════════════════════════════════════

قبل النشر:
□ جميع المفاتيح موجودة في Replit Secrets (7 مفاتيح)
□ Database Schema مطبق في Supabase
□ Site URL معد في Supabase: https://nnh.ae
□ Google Provider معد في Supabase
□ Redirect URI موجود في Google Console: https://nnh.ae/api/gmb/oauth-callback
□ APIs مفعلة في Google Console
□ OAuth Consent Screen معد

الاختبار:
□ الموقع يفتح بدون أخطاء
□ تسجيل الدخول يعمل
□ Google OAuth يعمل
□ GMB Data يظهر بشكل صحيح

النشر:
□ Deploy على Replit ناجح
□ Custom domain مربوط: nnh.ae
□ SSL certificate active
□ الموقع يعمل على https://nnh.ae

═══════════════════════════════════════════════════════════
📞 حل المشاكل الشائعة
═══════════════════════════════════════════════════════════

مشكلة: redirect_uri_mismatch
  → تأكد أن URI في Google Console: https://nnh.ae/api/gmb/oauth-callback
  → انتظر 5-10 دقائق بعد التغيير

مشكلة: Failed to fetch GMB accounts
  → تأكد من تفعيل APIs في Google Console
  → تأكد من أن حسابك له GMB locations

مشكلة: Database connection failed
  → راجع Supabase keys في Secrets
  → تأكد من تطبيق Migrations

مشكلة: 404 on deployment
  → تأكد من الـ workflow شغال
  → restart الـ workflow

═══════════════════════════════════════════════════════════
تاريخ الإنشاء: 29 أكتوبر 2025
الحالة: جاهز للاختبار والنشر ✅
═══════════════════════════════════════════════════════════
