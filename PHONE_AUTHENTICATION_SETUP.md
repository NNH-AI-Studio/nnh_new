# ุฅุนุฏุงุฏ ุชุณุฌูู ุงูุฏุฎูู ุจุฑูู ุงููุงุชู (Phone Authentication)

## ๐ ูุง ุชู ุฅุถุงูุชู:

โ **Migration ุชู ุฅูุดุงุคู**: `supabase/migrations/20250131_add_phone_to_profiles.sql`
- ุฅุถุงูุฉ `phone` column ุฅูู ุฌุฏูู `profiles`
- ุชุญุฏูุซ trigger function `handle_new_user()` ูุญูุธ ุฑูู ุงููุงุชู ุชููุงุฆูุงู
- ุฅุถุงูุฉ index ูุชุญุณูู ุงูุจุญุซ ุนู ุฑูู ุงููุงุชู

โ **ุงูููุฏ ููุฌูุฏ**: ูู `app/auth/login/page.tsx`
- ุฏุนู ูุงูู ูุชุณุฌูู ุงูุฏุฎูู ุจุฑูู ุงููุงุชู
- ุฅุฑุณุงู OTP code
- ุงูุชุญูู ูู ุงูููุฏ

## ๐ง ุฎุทูุงุช ุชูุนูู Phone Authentication ูู Supabase:

### 1. ุชูุนูู Phone Authentication ูู Supabase Dashboard

1. ุงุฐูุจ ุฅูู **Supabase Dashboard** โ ูุดุฑูุนู
2. ุงูุชุญ **Authentication** ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
3. ุงุถุบุท ุนูู **Providers**
4. ุงุจุญุซ ุนู **Phone** ูู ูุงุฆูุฉ ุงููุฒูุฏูู
5. ูุนูู **Phone provider** (Toggle On)

### 2. ุฅุนุฏุงุฏ SMS Provider

Supabase ูุญุชุงุฌ ุฅูู ูุฒูุฏ SMS ูุฅุฑุณุงู ุฑุณุงุฆู ุงูุชุญูู. ุงูุฎูุงุฑุงุช:

#### **ุฃ) ุงุณุชุฎุฏุงู Twilio (ูููุตู ุจู)**
1. ุณุฌูู ูู [Twilio](https://www.twilio.com/)
2. ุงุญุตู ุนูู:
   - `Account SID`
   - `Auth Token`
   - `Phone Number` (ููุฅุฑุณุงู)
3. ูู Supabase Dashboard:
   - ุงุฐูุจ ุฅูู **Settings** โ **Auth**
   - ูู ูุณู **Phone Auth**
   - ุฃุฏุฎู ุจูุงูุงุช Twilio

#### **ุจ) ุงุณุชุฎุฏุงู MessageBird**
1. ุณุฌูู ูู [MessageBird](https://www.messagebird.com/)
2. ุงุญุตู ุนูู API key
3. ุฃุถููุง ูู Supabase Settings

#### **ุฌ) ุงุณุชุฎุฏุงู Vonage (Nexmo)**
1. ุณุฌูู ูู [Vonage](https://www.vonage.com/)
2. ุงุญุตู ุนูู API credentials
3. ุฃุถููุง ูู Supabase Settings

### 3. ุชุดุบูู Migration ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูู Supabase Dashboard:
1. ุงุฐูุจ ุฅูู **SQL Editor**
2. ุงูุณุฎ ูุญุชูู ุงูููู: `supabase/migrations/20250131_add_phone_to_profiles.sql`
3. ูููุฐ ุงูู SQL script

ุฃู ุนุจุฑ CLI:
```bash
cd ~/Desktop/NNH-AI-Studio
supabase migration up
```

### 4. ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)

#### ุชุญุฏูุซ Phone Format
ููููู ุชุญุฏูุซ ุงูููุฏ ูู `app/auth/login/page.tsx` ูุฅุถุงูุฉ ุชูุณูู ุฑูู ุงููุงุชู:

```typescript
// ูุซุงู: ุชูุณูู +971501234567
const formatPhoneNumber = (phone: string) => {
  // ุฅุฒุงูุฉ ุงููุณุงูุงุช ูุงูุฑููุฒ
  const cleaned = phone.replace(/\D/g, '');
  // ุฅุถุงูุฉ + ูู ุงูุจุฏุงูุฉ ุฅุฐุง ูู ููู ููุฌูุฏุงู
  return cleaned.startsWith('+') ? cleaned : `+${cleaned}`;
};
```

#### ุชุญุฏูุซ UI ูู ุตูุญุฉ Login
ุงูููุฏ ููุฌูุฏ ูู `app/auth/login/page.tsx` ููุญุชูู ุนูู:
- ุญูู ุฅุฏุฎุงู ุฑูู ุงููุงุชู
- ุฒุฑ "ุฅุฑุณุงู ุงูููุฏ"
- ุญูู ุฅุฏุฎุงู OTP code
- ุฒุฑ "ุชุญูู"

## โ ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ุจุฑูู ุงููุงุชู:

1. ุงูุชุญ ุตูุญุฉ Login: `/auth/login`
2. ุงุฎุชุฑ tab "Phone Login" (ุฅุฐุง ูุงู ููุฌูุฏุงู)
3. ุฃุฏุฎู ุฑูู ูุงุชูู ุจุตูุบุฉ ุฏูููุฉ (ูุซุงู: `+971501234567`)
4. ุงุถุบุท "Send Code"
5. ุชุญูู ูู ุฑุณุงูุฉ SMS
6. ุฃุฏุฎู ุงูููุฏ ุงูุฐู ุงุณุชููุชู
7. ุงุถุบุท "Verify"

## ๐ ููุงุญุธุงุช ูููุฉ:

1. **ุฑูู ุงููุงุชู ูุฌุจ ุฃู ูููู ุจุตูุบุฉ ุฏูููุฉ**: `+[Country Code][Number]`
   - ูุซุงู: `+971501234567` (ุงูุฅูุงุฑุงุช)
   - ูุซุงู: `+966501234567` (ุงูุณุนูุฏูุฉ)

2. **Supabase ูุญูุธ ุฑูู ุงููุงุชู ูู `auth.users.phone` ุชููุงุฆูุงู**ุ ููููุง ุฃุถููุงู ุฃูุถุงู ูู `profiles.phone` ูููุตูู ุงูุณุฑูุน.

3. **ูู ุจูุฆุฉ ุงูุชุทููุฑ**: ููููู ุงุณุชุฎุฏุงู ุฑูู ุงุฎุชุจุงุฑ ูู Twilio ุจุฏูู ุชูููุฉ (ูุญุฏูุฏ).

4. **ุงูุชูููุฉ**: ูู ุฑุณุงูุฉ SMS ุชููู ุญูุงูู $0.0075 - $0.01 ุญุณุจ ุงููุฒูุฏ.

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:

### ุงููุดููุฉ: "SMS provider not configured"
**ุงูุญู**: ุชุฃูุฏ ูู ุฅุถุงูุฉ ุจูุงูุงุช ูุฒูุฏ SMS ูู Supabase Settings.

### ุงููุดููุฉ: "Invalid phone number"
**ุงูุญู**: ุชุฃูุฏ ูู ุชูุณูู ุฑูู ุงููุงุชู ุจุตูุบุฉ ุฏูููุฉ ูุน + ูู ุงูุจุฏุงูุฉ.

### ุงููุดููุฉ: "OTP expired"
**ุงูุญู**: ุงูููุฏ ุตุงูุญ ูู 60 ุฏูููุฉ ููุท. ุงุทูุจ ููุฏ ุฌุฏูุฏ.

## ๐ ูุฑุงุฌุน:
- [Supabase Phone Auth Documentation](https://supabase.com/docs/guides/auth/phone-login)
- [Twilio Setup Guide](https://www.twilio.com/docs/sms)
- [Supabase Auth Configuration](https://supabase.com/docs/guides/auth)

